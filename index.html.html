<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>KHAOS 1.1 - Sistema de Gestão de Veículos</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        :root {
            --primary-color: #2c3e50;
            --secondary-color: #3498db;
            --accent-color: #e74c3c;
            --light-color: #ecf0f1;
            --dark-color: #2c3e50;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: #f8f9fa;
            color: #333;
        }
        
        .navbar {
            background-color: var(--primary-color);
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        
        .navbar-brand {
            font-weight: 700;
            font-size: 1.5rem;
        }
        
        .card {
            border: none;
            border-radius: 10px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            margin-bottom: 20px;
            transition: transform 0.3s;
        }
        
        .card:hover {
            transform: translateY(-5px);
        }
        
        .card-header {
            background-color: var(--primary-color);
            color: white;
            border-radius: 10px 10px 0 0 !important;
            font-weight: 600;
        }
        
        .btn-primary {
            background-color: var(--secondary-color);
            border: none;
        }
        
        .btn-primary:hover {
            background-color: #2980b9;
        }
        
        .dashboard-card {
            text-align: center;
            padding: 20px;
        }
        
        .dashboard-number {
            font-size: 2.5rem;
            font-weight: 700;
            margin: 10px 0;
        }
        
        .stat-card {
            background: linear-gradient(135deg, var(--secondary-color), #8e44ad);
            color: white;
        }
        
        .form-section {
            margin-bottom: 30px;
        }
        
        .section-title {
            border-bottom: 2px solid var(--secondary-color);
            padding-bottom: 10px;
            margin-bottom: 20px;
            color: var(--primary-color);
        }
        
        .badge-expired {
            background-color: var(--accent-color);
        }
        
        .badge-warning {
            background-color: #f39c12;
        }
        
        .badge-success {
            background-color: #27ae60;
        }
        
        .table-responsive {
            border-radius: 10px;
            overflow: hidden;
        }
        
        .table th {
            background-color: var(--primary-color);
            color: white;
        }
        
        .action-buttons .btn {
            margin-right: 5px;
        }
        
        @media print {
            .no-print {
                display: none !important;
            }
            
            .print-only {
                display: block !important;
            }
            
            .card {
                box-shadow: none;
                border: 1px solid #ddd;
            }
        }
        
        .print-only {
            display: none;
        }
    </style>
</head>
<body>
    <!-- Navbar -->
    <nav class="navbar navbar-expand-lg navbar-dark">
        <div class="container">
            <a class="navbar-brand" href="#">
                <i class="fas fa-car me-2"></i>KHAOS 1.1
            </a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav ms-auto">
                    <li class="nav-item">
                        <a class="nav-link active" href="#dashboard"><i class="fas fa-tachometer-alt me-1"></i> Dashboard</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="#cadastro"><i class="fas fa-plus-circle me-1"></i> Cadastrar Veículo</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="#veiculos"><i class="fas fa-list me-1"></i> Lista de Veículos</a>
                    </li>
                </ul>
            </div>
        </div>
    </nav>

    <div class="container mt-4">
        <!-- Dashboard -->
        <section id="dashboard" class="mb-5">
            <h2 class="section-title">Dashboard</h2>
            
            <div class="row">
                <!-- Cards de Resumo -->
                <div class="col-md-3">
                    <div class="card dashboard-card">
                        <div class="card-body">
                            <i class="fas fa-car fa-2x text-primary"></i>
                            <h3 class="dashboard-number" id="total-veiculos">0</h3>
                            <p>Total de Veículos</p>
                            <button class="btn btn-sm btn-outline-primary no-print" onclick="imprimirRelatorio('total')">
                                <i class="fas fa-print me-1"></i> Imprimir
                            </button>
                        </div>
                    </div>
                </div>
                
                <div class="col-md-3">
                    <div class="card dashboard-card">
                        <div class="card-body">
                            <i class="fas fa-shield-alt fa-2x text-success"></i>
                            <h3 class="dashboard-number" id="total-placa-seguranca">0</h3>
                            <p>Com Placa de Segurança</p>
                            <button class="btn btn-sm btn-outline-success no-print" onclick="imprimirRelatorio('placa-seguranca')">
                                <i class="fas fa-print me-1"></i> Imprimir
                            </button>
                        </div>
                    </div>
                </div>
                
                <div class="col-md-3">
                    <div class="card dashboard-card">
                        <div class="card-body">
                            <i class="fas fa-exclamation-triangle fa-2x text-warning"></i>
                            <h3 class="dashboard-number" id="total-proximo-vencimento">0</h3>
                            <p>Próximos ao Vencimento</p>
                            <button class="btn btn-sm btn-outline-warning no-print" onclick="imprimirRelatorio('proximo-vencimento')">
                                <i class="fas fa-print me-1"></i> Imprimir
                            </button>
                        </div>
                    </div>
                </div>
                
                <div class="col-md-3">
                    <div class="card dashboard-card">
                        <div class="card-body">
                            <i class="fas fa-times-circle fa-2x text-danger"></i>
                            <h3 class="dashboard-number" id="total-vencidos">0</h3>
                            <p>Placas Vencidas</p>
                            <button class="btn btn-sm btn-outline-danger no-print" onclick="imprimirRelatorio('vencidos')">
                                <i class="fas fa-print me-1"></i> Imprimir
                            </button>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Estatísticas por Assunto -->
            <div class="row mt-4">
                <div class="col-12">
                    <div class="card">
                        <div class="card-header">
                            <i class="fas fa-chart-pie me-2"></i> Estatísticas por Assunto
                        </div>
                        <div class="card-body">
                            <div class="row" id="estatisticas-assunto">
                                <!-- As estatísticas serão geradas dinamicamente -->
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Exportar/Importar -->
            <div class="row mt-4 no-print">
                <div class="col-12">
                    <div class="card">
                        <div class="card-header">
                            <i class="fas fa-file-export me-2"></i> Exportar/Importar Dados
                        </div>
                        <div class="card-body">
                            <div class="d-flex gap-2">
                                <button class="btn btn-success" onclick="exportarDados()">
                                    <i class="fas fa-file-export me-1"></i> Exportar Dados
                                </button>
                                <button class="btn btn-primary" onclick="document.getElementById('import-file').click()">
                                    <i class="fas fa-file-import me-1"></i> Importar Dados
                                </button>
                                <input type="file" id="import-file" accept=".json" style="display: none;" onchange="importarDados(this)">
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>
        
        <!-- Formulário de Cadastro -->
        <section id="cadastro" class="mb-5">
            <h2 class="section-title">Cadastrar Veículo</h2>
            
            <div class="card">
                <div class="card-header">
                    <i class="fas fa-plus-circle me-2"></i> Novo Veículo
                </div>
                <div class="card-body">
                    <form id="form-veiculo">
                        <div class="row">
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label for="propriedade" class="form-label">Propriedade</label>
                                    <div class="input-group">
                                        <select class="form-select" id="propriedade">
                                            <option value="">Selecione...</option>
                                            <option value="ALAGOANA">ALAGOANA</option>
                                            <option value="AMÉRICA">AMÉRICA</option>
                                            <option value="ANDRADE & LUCENA">ANDRADE & LUCENA</option>
                                            <option value="BRASCAR">BRASCAR</option>
                                            <option value="EQUILÍBRIO">EQUILÍBRIO</option>
                                            <option value="JUSTIÇA">JUSTIÇA</option>
                                            <option value="LOCALIZA">LOCALIZA</option>
                                            <option value="OFICIAL">OFICIAL</option>
                                            <option value="OK LOCADORA">OK LOCADORA</option>
                                            <option value="PB SERVIÇOS">PB SERVIÇOS</option>
                                            <option value="PEGASUS">PEGASUS</option>
                                            <option value="RVM">RVM</option>
                                            <option value="SÃO SEBASTIÃO">SÃO SEBASTIÃO</option>
                                        </select>
                                        <button type="button" class="btn btn-outline-secondary" onclick="adicionarPropriedade()">
                                            <i class="fas fa-plus"></i>
                                        </button>
                                        <button type="button" class="btn btn-outline-danger" onclick="removerPropriedade()">
                                            <i class="fas fa-minus"></i>
                                        </button>
                                    </div>
                                </div>
                                
                                <div class="mb-3">
                                    <label for="veiculo" class="form-label">Veículo</label>
                                    <input type="text" class="form-control" id="veiculo" required>
                                </div>
                                
                                <div class="row">
                                    <div class="col-md-6">
                                        <div class="mb-3">
                                            <label for="uf" class="form-label">UF</label>
                                            <select class="form-select" id="uf">
                                                <option value="">Selecione...</option>
                                                <!-- Estados serão carregados dinamicamente -->
                                            </select>
                                        </div>
                                    </div>
                                    <div class="col-md-6">
                                        <div class="mb-3">
                                            <label for="capital" class="form-label">Capital</label>
                                            <select class="form-select" id="capital">
                                                <option value="">Selecione...</option>
                                                <!-- Capitais serão carregadas dinamicamente -->
                                            </select>
                                        </div>
                                    </div>
                                </div>
                                
                                <div class="mb-3">
                                    <label for="placa" class="form-label">Placa</label>
                                    <input type="text" class="form-control" id="placa" maxlength="7" required>
                                </div>
                                
                                <div class="mb-3">
                                    <label for="placa-seguranca" class="form-label">Placa de Segurança</label>
                                    <input type="text" class="form-control" id="placa-seguranca">
                                </div>
                                
                                <div class="row">
                                    <div class="col-md-6">
                                        <div class="mb-3">
                                            <label for="data-inicio" class="form-label">Data de Início</label>
                                            <input type="date" class="form-control" id="data-inicio" onchange="calcularDataTermino()">
                                        </div>
                                    </div>
                                    <div class="col-md-6">
                                        <div class="mb-3">
                                            <label for="data-termino" class="form-label">Data de Término</label>
                                            <input type="date" class="form-control" id="data-termino" readonly>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label for="renavam" class="form-label">RENAVAM</label>
                                    <input type="number" class="form-control" id="renavam">
                                </div>
                                
                                <div class="mb-3">
                                    <label for="cnpj" class="form-label">CNPJ</label>
                                    <input type="text" class="form-control" id="cnpj">
                                </div>
                                
                                <div class="mb-3">
                                    <label for="propriedade-texto" class="form-label">Propriedade (Texto)</label>
                                    <input type="text" class="form-control" id="propriedade-texto">
                                </div>
                                
                                <div class="mb-3">
                                    <label for="crlv-cprlv" class="form-label">CRLV/CPRLV</label>
                                    <input type="text" class="form-control" id="crlv-cprlv">
                                </div>
                                
                                <div class="mb-3">
                                    <label for="assunto" class="form-label">Assunto</label>
                                    <div class="input-group">
                                        <select class="form-select" id="assunto">
                                            <option value="">Selecione...</option>
                                            <option value="BAIXADO">BAIXADO</option>
                                            <option value="CARTÃO DE SEGURANÇA DE CANCELAMENTO">CARTÃO DE SEGURANÇA DE CANCELAMENTO</option>
                                            <option value="CPRLV">CPRLV</option>
                                            <option value="CARTÃO DE SEGURANÇA DE RENOVAÇÃO">CARTÃO DE SEGURANÇA DE RENOVAÇÃO</option>
                                            <option value="CARTÃO DE SEGURANÇA DE RENOVAÇÃO DE CPRLV">CARTÃO DE SEGURANÇA DE RENOVAÇÃO DE CPRLV</option>
                                            <option value="RENOVAÇÃO DE CRLV">RENOVAÇÃO DE CRLV</option>
                                            <option value="TRANSFERÊNCIA">TRANSFERÊNCIA</option>
                                            <option value="CARTÃO DE SEGURANÇA DE TRANSFERÊNCIA">CARTÃO DE SEGURANÇA DE TRANSFERÊNCIA</option>
                                        </select>
                                        <button type="button" class="btn btn-outline-secondary" onclick="adicionarAssunto()">
                                            <i class="fas fa-plus"></i>
                                        </button>
                                        <button type="button" class="btn btn-outline-danger" onclick="removerAssunto()">
                                            <i class="fas fa-minus"></i>
                                        </button>
                                    </div>
                                </div>
                                
                                <div class="mb-3">
                                    <label for="sei-adm" class="form-label">SEI/ADM</label>
                                    <input type="text" class="form-control" id="sei-adm" placeholder="Ex: E:20105.000012248/2025">
                                </div>
                                
                                <div class="mb-3">
                                    <label for="andamento-obs" class="form-label">Andamento/Observações</label>
                                    <textarea class="form-control" id="andamento-obs" rows="2"></textarea>
                                </div>
                                
                                <div class="row">
                                    <div class="col-md-6">
                                        <div class="mb-3">
                                            <label for="mes" class="form-label">Mês</label>
                                            <select class="form-select" id="mes">
                                                <option value="">Selecione...</option>
                                                <option value="1">Janeiro</option>
                                                <option value="2">Fevereiro</option>
                                                <option value="3">Março</option>
                                                <option value="4">Abril</option>
                                                <option value="5">Maio</option>
                                                <option value="6">Junho</option>
                                                <option value="7">Julho</option>
                                                <option value="8">Agosto</option>
                                                <option value="9">Setembro</option>
                                                <option value="10">Outubro</option>
                                                <option value="11">Novembro</option>
                                                <option value="12">Dezembro</option>
                                            </select>
                                        </div>
                                    </div>
                                    <div class="col-md-6">
                                        <div class="mb-3">
                                            <label for="ano" class="form-label">Ano</label>
                                            <input type="number" class="form-control" id="ano" min="2000" max="2030" value="2025">
                                        </div>
                                    </div>
                                </div>
                                
                                <div class="mb-3">
                                    <label for="localidade" class="form-label">Localidade</label>
                                    <input type="text" class="form-control" id="localidade">
                                </div>
                                
                                <div class="mb-3">
                                    <label for="estado" class="form-label">Estado</label>
                                    <div class="input-group">
                                        <select class="form-select" id="estado">
                                            <option value="">Selecione...</option>
                                            <option value="ATIVO">ATIVO</option>
                                            <option value="INATIVO">INATIVO</option>
                                            <option value="BAIXADO">BAIXADO</option>
                                            <option value="INCERTO">INCERTO</option>
                                        </select>
                                        <button type="button" class="btn btn-outline-secondary" onclick="adicionarEstado()">
                                            <i class="fas fa-plus"></i>
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="d-flex justify-content-end mt-4">
                            <button type="button" class="btn btn-secondary me-2" onclick="limparFormulario()">
                                <i class="fas fa-times me-1"></i> Limpar
                            </button>
                            <button type="submit" class="btn btn-primary">
                                <i class="fas fa-save me-1"></i> Salvar Veículo
                            </button>
                        </div>
                    </form>
                </div>
            </div>
        </section>
        
        <!-- Lista de Veículos -->
        <section id="veiculos" class="mb-5">
            <h2 class="section-title">Lista de Veículos</h2>
            
            <div class="card">
                <div class="card-header d-flex justify-content-between align-items-center">
                    <span><i class="fas fa-list me-2"></i> Veículos Cadastrados</span>
                    <div class="input-group w-auto">
                        <input type="text" class="form-control" placeholder="Buscar..." id="buscar-veiculo">
                        <button class="btn btn-outline-secondary" type="button" onclick="filtrarVeiculos()">
                            <i class="fas fa-search"></i>
                        </button>
                    </div>
                </div>
                <div class="card-body">
                    <div class="table-responsive">
                        <table class="table table-striped table-hover">
                            <thead>
                                <tr>
                                    <th>Propriedade</th>
                                    <th>Veículo</th>
                                    <th>Placa</th>
                                    <th>Placa Segurança</th>
                                    <th>Vencimento</th>
                                    <th>Assunto</th>
                                    <th>Estado</th>
                                    <th class="no-print">Ações</th>
                                </tr>
                            </thead>
                            <tbody id="tabela-veiculos">
                                <!-- Os veículos serão carregados dinamicamente -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </section>
    </div>

    <!-- Modal para adicionar propriedade -->
    <div class="modal fade" id="modalPropriedade" tabindex="-1">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Adicionar Propriedade</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <div class="mb-3">
                        <label for="nova-propriedade" class="form-label">Nova Propriedade</label>
                        <input type="text" class="form-control" id="nova-propriedade">
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
                    <button type="button" class="btn btn-primary" onclick="confirmarAdicionarPropriedade()">Adicionar</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal para adicionar assunto -->
    <div class="modal fade" id="modalAssunto" tabindex="-1">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Adicionar Assunto</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <div class="mb-3">
                        <label for="novo-assunto" class="form-label">Novo Assunto</label>
                        <input type="text" class="form-control" id="novo-assunto">
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
                    <button type="button" class="btn btn-primary" onclick="confirmarAdicionarAssunto()">Adicionar</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal para adicionar estado -->
    <div class="modal fade" id="modalEstado" tabindex="-1">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Adicionar Estado</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <div class="mb-3">
                        <label for="novo-estado" class="form-label">Novo Estado</label>
                        <input type="text" class="form-control" id="novo-estado">
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
                    <button type="button" class="btn btn-primary" onclick="confirmarAdicionarEstado()">Adicionar</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Scripts -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        // Dados iniciais
        let veiculos = JSON.parse(localStorage.getItem('veiculos')) || [];
        let propriedades = JSON.parse(localStorage.getItem('propriedades')) || [
            "ALAGOANA", "AMÉRICA", "ANDRADE & LUCENA", "BRASCAR", "EQUILÍBRIO", 
            "JUSTIÇA", "LOCALIZA", "OFICIAL", "OK LOCADORA", "PB SERVIÇOS", 
            "PEGASUS", "RVM", "SÃO SEBASTIÃO"
        ];
        let assuntos = JSON.parse(localStorage.getItem('assuntos')) || [
            "BAIXADO", "CARTÃO DE SEGURANÇA DE CANCELAMENTO", "CPRLV", 
            "CARTÃO DE SEGURANÇA DE RENOVAÇÃO", "CARTÃO DE SEGURANÇA DE RENOVAÇÃO DE CPRLV", 
            "RENOVAÇÃO DE CRLV", "TRANSFERÊNCIA", "CARTÃO DE SEGURANÇA DE TRANSFERÊNCIA"
        ];
        let estados = JSON.parse(localStorage.getItem('estados')) || [
            "ATIVO", "INATIVO", "BAIXADO", "INCERTO"
        ];

        // Inicialização
        document.addEventListener('DOMContentLoaded', function() {
            carregarEstadosUF();
            carregarCapitais();
            carregarPropriedades();
            carregarAssuntos();
            carregarEstados();
            atualizarDashboard();
            carregarTabelaVeiculos();
            
            // Event listener para o formulário
            document.getElementById('form-veiculo').addEventListener('submit', function(e) {
                e.preventDefault();
                salvarVeiculo();
            });
        });

        // Funções para carregar dados
        function carregarEstadosUF() {
            const ufSelect = document.getElementById('uf');
            const estadosUF = [
                "AC", "AL", "AP", "AM", "BA", "CE", "DF", "ES", "GO", "MA", 
                "MT", "MS", "MG", "PA", "PB", "PR", "PE", "PI", "RJ", "RN", 
                "RS", "RO", "RR", "SC", "SP", "SE", "TO"
            ];
            
            estadosUF.forEach(uf => {
                const option = document.createElement('option');
                option.value = uf;
                option.textContent = uf;
                ufSelect.appendChild(option);
            });
        }

        function carregarCapitais() {
            const capitalSelect = document.getElementById('capital');
            const capitais = [
                "Rio Branco", "Maceió", "Macapá", "Manaus", "Salvador", "Fortaleza", 
                "Brasília", "Vitória", "Goiânia", "São Luís", "Cuiabá", "Campo Grande", 
                "Belo Horizonte", "Belém", "João Pessoa", "Curitiba", "Recife", 
                "Teresina", "Rio de Janeiro", "Natal", "Porto Alegre", "Porto Velho", 
                "Boa Vista", "Florianópolis", "São Paulo", "Aracaju", "Palmas"
            ];
            
            capitais.forEach(capital => {
                const option = document.createElement('option');
                option.value = capital;
                option.textContent = capital;
                capitalSelect.appendChild(option);
            });
        }

        function carregarPropriedades() {
            const propriedadeSelect = document.getElementById('propriedade');
            propriedadeSelect.innerHTML = '<option value="">Selecione...</option>';
            
            propriedades.forEach(propriedade => {
                const option = document.createElement('option');
                option.value = propriedade;
                option.textContent = propriedade;
                propriedadeSelect.appendChild(option);
            });
        }

        function carregarAssuntos() {
            const assuntoSelect = document.getElementById('assunto');
            assuntoSelect.innerHTML = '<option value="">Selecione...</option>';
            
            assuntos.forEach(assunto => {
                const option = document.createElement('option');
                option.value = assunto;
                option.textContent = assunto;
                assuntoSelect.appendChild(option);
            });
            
            // Atualizar estatísticas
            atualizarEstatisticasAssunto();
        }

        function carregarEstados() {
            const estadoSelect = document.getElementById('estado');
            estadoSelect.innerHTML = '<option value="">Selecione...</option>';
            
            estados.forEach(estado => {
                const option = document.createElement('option');
                option.value = estado;
                option.textContent = estado;
                estadoSelect.appendChild(option);
            });
        }

        // Funções para adicionar/remover opções
        function adicionarPropriedade() {
            document.getElementById('nova-propriedade').value = '';
            const modal = new bootstrap.Modal(document.getElementById('modalPropriedade'));
            modal.show();
        }

        function confirmarAdicionarPropriedade() {
            const novaPropriedade = document.getElementById('nova-propriedade').value.trim();
            if (novaPropriedade && !propriedades.includes(novaPropriedade)) {
                propriedades.push(novaPropriedade);
                localStorage.setItem('propriedades', JSON.stringify(propriedades));
                carregarPropriedades();
                bootstrap.Modal.getInstance(document.getElementById('modalPropriedade')).hide();
            }
        }

        function removerPropriedade() {
            const propriedadeSelect = document.getElementById('propriedade');
            const selectedValue = propriedadeSelect.value;
            
            if (selectedValue && confirm(`Deseja remover a propriedade "${selectedValue}"?`)) {
                const index = propriedades.indexOf(selectedValue);
                if (index > -1) {
                    propriedades.splice(index, 1);
                    localStorage.setItem('propriedades', JSON.stringify(propriedades));
                    carregarPropriedades();
                }
            }
        }

        function adicionarAssunto() {
            document.getElementById('novo-assunto').value = '';
            const modal = new bootstrap.Modal(document.getElementById('modalAssunto'));
            modal.show();
        }

        function confirmarAdicionarAssunto() {
            const novoAssunto = document.getElementById('novo-assunto').value.trim();
            if (novoAssunto && !assuntos.includes(novoAssunto)) {
                assuntos.push(novoAssunto);
                localStorage.setItem('assuntos', JSON.stringify(assuntos));
                carregarAssuntos();
                bootstrap.Modal.getInstance(document.getElementById('modalAssunto')).hide();
            }
        }

        function removerAssunto() {
            const assuntoSelect = document.getElementById('assunto');
            const selectedValue = assuntoSelect.value;
            
            if (selectedValue && confirm(`Deseja remover o assunto "${selectedValue}"?`)) {
                const index = assuntos.indexOf(selectedValue);
                if (index > -1) {
                    assuntos.splice(index, 1);
                    localStorage.setItem('assuntos', JSON.stringify(assuntos));
                    carregarAssuntos();
                }
            }
        }

        function adicionarEstado() {
            document.getElementById('novo-estado').value = '';
            const modal = new bootstrap.Modal(document.getElementById('modalEstado'));
            modal.show();
        }

        function confirmarAdicionarEstado() {
            const novoEstado = document.getElementById('novo-estado').value.trim();
            if (novoEstado && !estados.includes(novoEstado)) {
                estados.push(novoEstado);
                localStorage.setItem('estados', JSON.stringify(estados));
                carregarEstados();
                bootstrap.Modal.getInstance(document.getElementById('modalEstado')).hide();
            }
        }

        // Funções para o formulário
        function calcularDataTermino() {
            const dataInicio = document.getElementById('data-inicio').value;
            if (dataInicio) {
                const data = new Date(dataInicio);
                data.setFullYear(data.getFullYear() + 1);
                document.getElementById('data-termino').value = data.toISOString().split('T')[0];
            }
        }

        function limparFormulario() {
            document.getElementById('form-veiculo').reset();
            document.getElementById('data-termino').value = '';
        }

        function salvarVeiculo() {
            const veiculo = {
                id: Date.now(),
                propriedade: document.getElementById('propriedade').value,
                veiculo: document.getElementById('veiculo').value,
                uf: document.getElementById('uf').value,
                capital: document.getElementById('capital').value,
                placa: document.getElementById('placa').value,
                placaSeguranca: document.getElementById('placa-seguranca').value,
                dataInicio: document.getElementById('data-inicio').value,
                dataTermino: document.getElementById('data-termino').value,
                renavam: document.getElementById('renavam').value,
                cnpj: document.getElementById('cnpj').value,
                propriedadeTexto: document.getElementById('propriedade-texto').value,
                crlvCprlv: document.getElementById('crlv-cprlv').value,
                assunto: document.getElementById('assunto').value,
                seiAdm: document.getElementById('sei-adm').value,
                andamentoObs: document.getElementById('andamento-obs').value,
                mes: document.getElementById('mes').value,
                ano: document.getElementById('ano').value,
                localidade: document.getElementById('localidade').value,
                estado: document.getElementById('estado').value
            };
            
            veiculos.push(veiculo);
            localStorage.setItem('veiculos', JSON.stringify(veiculos));
            
            atualizarDashboard();
            carregarTabelaVeiculos();
            limparFormulario();
            
            alert('Veículo cadastrado com sucesso!');
        }

        // Funções para a tabela
        function carregarTabelaVeiculos() {
            const tabela = document.getElementById('tabela-veiculos');
            tabela.innerHTML = '';
            
            veiculos.forEach(veiculo => {
                const tr = document.createElement('tr');
                
                // Verificar status da placa de segurança
                let statusBadge = '';
                if (veiculo.dataTermino) {
                    const hoje = new Date();
                    const dataTermino = new Date(veiculo.dataTermino);
                    const diffTime = dataTermino - hoje;
                    const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));
                    
                    if (diffDays < 0) {
                        statusBadge = '<span class="badge bg-danger">Vencida</span>';
                    } else if (diffDays <= 30) {
                        statusBadge = '<span class="badge bg-warning">Próximo</span>';
                    } else {
                        statusBadge = '<span class="badge bg-success">Válida</span>';
                    }
                }
                
                tr.innerHTML = `
                    <td>${veiculo.propriedade || '-'}</td>
                    <td>${veiculo.veiculo || '-'}</td>
                    <td>${veiculo.placa || '-'}</td>
                    <td>${veiculo.placaSeguranca || '-'}</td>
                    <td>${veiculo.dataTermino ? formatarData(veiculo.dataTermino) : '-'} ${statusBadge}</td>
                    <td>${veiculo.assunto || '-'}</td>
                    <td>${veiculo.estado || '-'}</td>
                    <td class="no-print action-buttons">
                        <button class="btn btn-sm btn-info" onclick="editarVeiculo(${veiculo.id})">
                            <i class="fas fa-edit"></i>
                        </button>
                        <button class="btn btn-sm btn-danger" onclick="excluirVeiculo(${veiculo.id})">
                            <i class="fas fa-trash"></i>
                        </button>
                    </td>
                `;
                
                tabela.appendChild(tr);
            });
        }

        function filtrarVeiculos() {
            const termo = document.getElementById('buscar-veiculo').value.toLowerCase();
            const linhas = document.getElementById('tabela-veiculos').getElementsByTagName('tr');
            
            for (let i = 0; i < linhas.length; i++) {
                const textoLinha = linhas[i].textContent.toLowerCase();
                if (textoLinha.includes(termo)) {
                    linhas[i].style.display = '';
                } else {
                    linhas[i].style.display = 'none';
                }
            }
        }

        function editarVeiculo(id) {
            const veiculo = veiculos.find(v => v.id === id);
            if (veiculo) {
                // Preencher o formulário com os dados do veículo
                document.getElementById('propriedade').value = veiculo.propriedade;
                document.getElementById('veiculo').value = veiculo.veiculo;
                document.getElementById('uf').value = veiculo.uf;
                document.getElementById('capital').value = veiculo.capital;
                document.getElementById('placa').value = veiculo.placa;
                document.getElementById('placa-seguranca').value = veiculo.placaSeguranca;
                document.getElementById('data-inicio').value = veiculo.dataInicio;
                document.getElementById('data-termino').value = veiculo.dataTermino;
                document.getElementById('renavam').value = veiculo.renavam;
                document.getElementById('cnpj').value = veiculo.cnpj;
                document.getElementById('propriedade-texto').value = veiculo.propriedadeTexto;
                document.getElementById('crlv-cprlv').value = veiculo.crlvCprlv;
                document.getElementById('assunto').value = veiculo.assunto;
                document.getElementById('sei-adm').value = veiculo.seiAdm;
                document.getElementById('andamento-obs').value = veiculo.andamentoObs;
                document.getElementById('mes').value = veiculo.mes;
                document.getElementById('ano').value = veiculo.ano;
                document.getElementById('localidade').value = veiculo.localidade;
                document.getElementById('estado').value = veiculo.estado;
                
                // Remover o veículo da lista para atualização
                veiculos = veiculos.filter(v => v.id !== id);
                localStorage.setItem('veiculos', JSON.stringify(veiculos));
                
                // Rolar para o formulário
                document.getElementById('cadastro').scrollIntoView();
            }
        }

        function excluirVeiculo(id) {
            if (confirm('Tem certeza que deseja excluir este veículo?')) {
                veiculos = veiculos.filter(v => v.id !== id);
                localStorage.setItem('veiculos', JSON.stringify(veiculos));
                atualizarDashboard();
                carregarTabelaVeiculos();
            }
        }

        // Funções para o dashboard
        function atualizarDashboard() {
            const totalVeiculos = veiculos.length;
            const totalComPlacaSeguranca = veiculos.filter(v => v.placaSeguranca).length;
            
            // Calcular próximos ao vencimento (30 dias)
            const hoje = new Date();
            const totalProximoVencimento = veiculos.filter(v => {
                if (!v.dataTermino) return false;
                const dataTermino = new Date(v.dataTermino);
                const diffTime = dataTermino - hoje;
                const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));
                return diffDays > 0 && diffDays <= 30;
            }).length;
            
            // Calcular vencidos
            const totalVencidos = veiculos.filter(v => {
                if (!v.dataTermino) return false;
                const dataTermino = new Date(v.dataTermino);
                return dataTermino < hoje;
            }).length;
            
            document.getElementById('total-veiculos').textContent = totalVeiculos;
            document.getElementById('total-placa-seguranca').textContent = totalComPlacaSeguranca;
            document.getElementById('total-proximo-vencimento').textContent = totalProximoVencimento;
            document.getElementById('total-vencidos').textContent = totalVencidos;
            
            atualizarEstatisticasAssunto();
        }

        function atualizarEstatisticasAssunto() {
            const container = document.getElementById('estatisticas-assunto');
            container.innerHTML = '';
            
            assuntos.forEach(assunto => {
                const count = veiculos.filter(v => v.assunto === assunto).length;
                
                const col = document.createElement('div');
                col.className = 'col-md-3 mb-3';
                
                col.innerHTML = `
                    <div class="card stat-card">
                        <div class="card-body text-center">
                            <h5>${assunto}</h5>
                            <h3 class="dashboard-number">${count}</h3>
                            <button class="btn btn-sm btn-light no-print" onclick="imprimirRelatorioAssunto('${assunto}')">
                                <i class="fas fa-print me-1"></i> Imprimir
                            </button>
                        </div>
                    </div>
                `;
                
                container.appendChild(col);
            });
        }

        // Funções para impressão
        function imprimirRelatorio(tipo) {
            let titulo = '';
            let veiculosFiltrados = [];
            
            switch(tipo) {
                case 'total':
                    titulo = 'KHAOS 1.1 - Relatório de Veículos Totais';
                    veiculosFiltrados = veiculos;
                    break;
                case 'placa-seguranca':
                    titulo = 'KHAOS 1.1 - Relatório de Veículos Placa de Segurança';
                    veiculosFiltrados = veiculos.filter(v => v.placaSeguranca);
                    break;
                case 'proximo-vencimento':
                    titulo = 'KHAOS 1.1 - Relatório de Veículos Placa de Segurança Próximo ao Vencimento';
                    const hoje = new Date();
                    veiculosFiltrados = veiculos.filter(v => {
                        if (!v.dataTermino) return false;
                        const dataTermino = new Date(v.dataTermino);
                        const diffTime = dataTermino - hoje;
                        const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));
                        return diffDays > 0 && diffDays <= 30;
                    });
                    break;
                case 'vencidos':
                    titulo = 'KHAOS 1.1 - Relatório de Veículos Placa de Segurança Vencidas';
                    const hoje2 = new Date();
                    veiculosFiltrados = veiculos.filter(v => {
                        if (!v.dataTermino) return false;
                        const dataTermino = new Date(v.dataTermino);
                        return dataTermino < hoje2;
                    });
                    break;
            }
            
            // Criar uma nova janela para impressão
            const janelaImpressao = window.open('', '_blank');
            janelaImpressao.document.write(`
                <html>
                    <head>
                        <title>${titulo}</title>
                        <style>
                            body { font-family: Arial, sans-serif; margin: 20px; }
                            h1 { text-align: center; margin-bottom: 20px; }
                            table { width: 100%; border-collapse: collapse; margin-top: 20px; }
                            th, td { border: 1px solid #ddd; padding: 8px; text-align: left; }
                            th { background-color: #f2f2f2; }
                        </style>
                    </head>
                    <body>
                        <h1>${titulo}</h1>
                        <table>
                            <thead>
                                <tr>
                                    <th>Propriedade</th>
                                    <th>Veículo</th>
                                    <th>Placa</th>
                                    <th>Placa Segurança</th>
                                    <th>Data Término</th>
                                    <th>Assunto</th>
                                    <th>SEI/ADM</th>
                                    <th>Localidade</th>
                                </tr>
                            </thead>
                            <tbody>
                                ${veiculosFiltrados.map(veiculo => `
                                    <tr>
                                        <td>${veiculo.propriedade || '-'}</td>
                                        <td>${veiculo.veiculo || '-'}</td>
                                        <td>${veiculo.placa || '-'}</td>
                                        <td>${veiculo.placaSeguranca || '-'}</td>
                                        <td>${veiculo.dataTermino ? formatarData(veiculo.dataTermino) : '-'}</td>
                                        <td>${veiculo.assunto || '-'}</td>
                                        <td>${veiculo.seiAdm || '-'}</td>
                                        <td>${veiculo.localidade || '-'}</td>
                                    </tr>
                                `).join('')}
                            </tbody>
                        </table>
                        <p style="margin-top: 20px; text-align: right;">Total: ${veiculosFiltrados.length} veículo(s)</p>
                    </body>
                </html>
            `);
            
            janelaImpressao.document.close();
            janelaImpressao.print();
        }

        function imprimirRelatorioAssunto(assunto) {
            const veiculosFiltrados = veiculos.filter(v => v.assunto === assunto);
            const titulo = `KHAOS 1.1 - Relatório de Veículos ${assunto}`;
            
            // Criar uma nova janela para impressão
            const janelaImpressao = window.open('', '_blank');
            janelaImpressao.document.write(`
                <html>
                    <head>
                        <title>${titulo}</title>
                        <style>
                            body { font-family: Arial, sans-serif; margin: 20px; }
                            h1 { text-align: center; margin-bottom: 20px; }
                            table { width: 100%; border-collapse: collapse; margin-top: 20px; }
                            th, td { border: 1px solid #ddd; padding: 8px; text-align: left; }
                            th { background-color: #f2f2f2; }
                        </style>
                    </head>
                    <body>
                        <h1>${titulo}</h1>
                        <table>
                            <thead>
                                <tr>
                                    <th>Propriedade</th>
                                    <th>Veículo</th>
                                    <th>Placa</th>
                                    <th>Placa Segurança</th>
                                    <th>Data Término</th>
                                    <th>SEI/ADM</th>
                                    <th>Localidade</th>
                                </tr>
                            </thead>
                            <tbody>
                                ${veiculosFiltrados.map(veiculo => `
                                    <tr>
                                        <td>${veiculo.propriedade || '-'}</td>
                                        <td>${veiculo.veiculo || '-'}</td>
                                        <td>${veiculo.placa || '-'}</td>
                                        <td>${veiculo.placaSeguranca || '-'}</td>
                                        <td>${veiculo.dataTermino ? formatarData(veiculo.dataTermino) : '-'}</td>
                                        <td>${veiculo.seiAdm || '-'}</td>
                                        <td>${veiculo.localidade || '-'}</td>
                                    </tr>
                                `).join('')}
                            </tbody>
                        </table>
                        <p style="margin-top: 20px; text-align: right;">Total: ${veiculosFiltrados.length} veículo(s)</p>
                    </body>
                </html>
            `);
            
            janelaImpressao.document.close();
            janelaImpressao.print();
        }

        // Funções para exportar/importar
        function exportarDados() {
            const dados = {
                veiculos: veiculos,
                propriedades: propriedades,
                assuntos: assuntos,
                estados: estados
            };
            
            const dadosStr = JSON.stringify(dados, null, 2);
            const blob = new Blob([dadosStr], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            
            const a = document.createElement('a');
            a.href = url;
            a.download = 'khaos_1.1_dados_' + new Date().toISOString().split('T')[0] + '.json';
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
        }

        function importarDados(input) {
            const file = input.files[0];
            if (!file) return;
            
            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const dados = JSON.parse(e.target.result);
                    
                    if (dados.veiculos) veiculos = dados.veiculos;
                    if (dados.propriedades) propriedades = dados.propriedades;
                    if (dados.assuntos) assuntos = dados.assuntos;
                    if (dados.estados) estados = dados.estados;
                    
                    localStorage.setItem('veiculos', JSON.stringify(veiculos));
                    localStorage.setItem('propriedades', JSON.stringify(propriedades));
                    localStorage.setItem('assuntos', JSON.stringify(assuntos));
                    localStorage.setItem('estados', JSON.stringify(estados));
                    
                    carregarPropriedades();
                    carregarAssuntos();
                    carregarEstados();
                    atualizarDashboard();
                    carregarTabelaVeiculos();
                    
                    alert('Dados importados com sucesso!');
                } catch (error) {
                    alert('Erro ao importar dados. Verifique se o arquivo é válido.');
                }
            };
            reader.readAsText(file);
            
            // Limpar o input para permitir importar o mesmo arquivo novamente
            input.value = '';
        }

        // Funções utilitárias
        function formatarData(data) {
            if (!data) return '-';
            const dataObj = new Date(data);
            return dataObj.toLocaleDateString('pt-BR');
        }
    </script>
</body>
</html>